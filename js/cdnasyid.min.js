// Generated by CoffeeScript 1.10.0
(function() {
  var $, CDNS, dev;

  $ = jQuery;

  CDNS = (function() {
    function CDNS() {}

    CDNS.dev = false;

    CDNS.window = $(window);

    CDNS.body = $('body');

    CDNS.log = function() {
      if (CDNS.dev) {
        return console.log.apply(console, arguments);
      }
    };

    CDNS.isMobile = function() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    };

    return CDNS;

  })();

  CDNS.Search = (function() {
    function Search() {
      $(document).on('keypress.cdns.search', (function(_this) {
        return function(e) {
          return _this.keypress(e);
        };
      })(this));
      $(document).on('keyup.cdns.search', function(e) {
        if ($('#fullscreen-search').is(':visible') && e.keyCode === 27) {
          return SWIFT.header.fsSearchToggle();
        }
      });
    }

    Search.prototype.keypress = function(e) {
      var nodeName;
      e = e || event;
      nodeName = e.target.nodeName;
      if (nodeName === 'INPUT' || nodeName === 'TEXTAREA') {
        return;
      }
      if (e.which !== 0 && e.charCode !== 0 && !e.ctrlKey && !e.metaKey && !e.altKey && e.keyCode !== 27 && e.keyCode !== 32) {
        if (CDNS.body.hasClass('overlay-menu-open')) {
          SWIFT.header.overlayMenuToggle();
        }
        if (CDNS.body.hasClass('fs-supersearch-open')) {
          SWIFT.header.fsSuperSearchToggle();
        }
        SWIFT.header.fsSearchToggle();
        return $('#fs-search-input').focus().val(String.fromCharCode(e.keyCode | e.charCode));
      }
    };

    return Search;

  })();

  CDNS.Forms = (function() {
    function Forms() {
      this.select2();
      this.formGroups();
    }

    Forms.prototype.select2 = function() {
      if (($().select2)) {
        $('select.orderby').select2({
          minimumResultsForSearch: Infinity
        });
        $('.shipping-calculator-form select').select2();
        return $('.woocommerce .widget select').select2();
      }
    };

    Forms.prototype.formGroups = function() {
      $('.form-group input, .form-group textarea').each(function() {
        var $input;
        $input = $(this);
        $input.focus(function() {
          return $input.closest('.form-group').addClass('focus');
        });
        return $input.blur(function() {
          return $input.closest('.form-group').removeClass('focus');
        });
      });
      return $('.wpcf7-form-control-wrap input').each(function() {
        return $(this).parent().before(this);
      });
    };

    return Forms;

  })();

  CDNS.Misc = (function() {
    function Misc() {
      this.mouseAnimation();
      this.categoryDescription();
      this.searchResultTitle();
      this.menuPlainText();
      this.productGridArtistWidth();
      this.others();
    }

    Misc.prototype.mouseAnimation = function() {
      if (!CDNS.isMobile()) {
        return $('#home-hero').append($('<div class="mouse"><div class="mouse-icon"><span class="mouse-wheel"></span></div></div>'));
      }
    };

    Misc.prototype.categoryDescription = function() {
      var cat_desc;
      cat_desc = $('.tax-product_cat .term-description');
      if (cat_desc.length) {
        return $('.tax-product_cat h1.entry-title').after('<h3>' + cat_desc.html() + '</h3>');
      }
    };

    Misc.prototype.searchResultTitle = function() {
      return $('.search-results .heading-text h1.entry-title').each(function() {
        var searchTitle;
        $(this).data('orig-text', $(this).text());
        searchTitle = $(this).text().split(/:\s/);
        return $(this).text(searchTitle[0]).append($('<h3>For the keyword <em>' + searchTitle[1] + '</em></h3>'));
      });
    };

    Misc.prototype.menuPlainText = function() {
      return $('.menu .non-link a').each(function() {
        return $(this).closest('li').html($(this).html());
      });
    };

    Misc.prototype.productGridArtistWidth = function() {
      var _fn;
      _fn = function() {
        return $('.woocommerce .products .product').each(function() {
          var product_by, product_by_artist, product_by_artist_width, product_by_by, product_by_by_width, product_by_width;
          product_by = $(this).find('.product-by');
          product_by_by = product_by.find('.product-by-by');
          product_by_artist = product_by.find('.product-by-artist');
          if (product_by.length) {
            product_by_width = product_by.outerWidth();
            product_by_by_width = product_by_by.outerWidth();
            product_by_artist_width = product_by_width - product_by_by_width - 2;
            return product_by_artist.css({
              'max-width': product_by_artist_width + 'px'
            });
          }
        });
      };
      _fn();
      return CDNS.window.smartresize(_fn);
    };

    Misc.prototype.others = function() {
      $('figure .cart-overlay .shop-actions > *').addClass('shop-action');
      $('.footer-social-1, .footer-social-2').longShadow({
        colorShadow: '#211537',
        sizeShadow: 400,
        directionShadow: 'bottom-right'
      });
      return $('#home-tilawah .woocommerce.product_list_widget').before('<div class="more-link"><a href="/product-category/tilawah">View all</a></div>');
    };

    return Misc;

  })();

  jQuery(function($) {
    new CDNS.Search;
    new CDNS.Forms;
    return new CDNS.Misc;
  });

  (function($) {
    var $window, isRTL, widget_colors;
    widget_colors = ['accent', 'turquoise', 'green', 'blue'];
    $('.woocommerce .widget').each(function(index) {
      var $this;
      $this = $(this);
      return $this.addClass('cdnclr-' + widget_colors[index % 4]);
    });
    isRTL = $('body').hasClass('rtl');
    $window = $(window);
    SWIFT.woocommerce._fullWidthShopSetSidebarHeight = SWIFT.woocommerce.fullWidthShopSetSidebarHeight;
    SWIFT.woocommerce.fullWidthShopSetSidebarHeight = function() {};
    SWIFT.woocommerce._shopLayoutSwitch = SWIFT.woocommerce.shopLayoutSwitch;
    return SWIFT.woocommerce.shopLayoutSwitch = function() {
      var isSwitchingLayout;
      isSwitchingLayout = false;
      return jQuery(document).on('click', 'a.layout-opt', function(e) {
        var defaultWidth, gridWidth, products, selectedLayout;
        products = jQuery('#products');
        selectedLayout = jQuery(this).data('layout');
        defaultWidth = products.find('.product').first().data('width');
        gridWidth = jQuery('.inner-page-wrap').hasClass('has-no-sidebar') ? 'col-sm-sf-5' : 'col-sm-3';
        if (jQuery(this).parent().data('display-type') === 'gallery' || jQuery(this).parent().data('display-type') === 'gallery-bordered') {
          gridWidth = 'col-sm-2';
        }
        if (isSwitchingLayout) {
          return;
        }
        isSwitchingLayout = true;
        products.animate({
          'opacity': 0
        }, 400);
        setTimeout((function() {
          products.find('.product').removeClass('product-layout-standard product-layout-list product-layout-grid product-layout-solo');
          products.find('.product').addClass('product-layout-' + selectedLayout);
          if (jQuery('.product-grid').length > 0) {
            jQuery('.product-grid').children().css('min-height', '0');
            if (selectedLayout === 'grid') {
              products.find('.product').removeClass(defaultWidth).addClass(gridWidth);
              products.find('.product').css('min-height', '0');
            }
            if (selectedLayout === 'standard' || selectedLayout === 'solo') {
              products.find('.product').removeClass(gridWidth).addClass(defaultWidth);
            }
            if (selectedLayout === 'list') {
              products.find('.product').css('height', 'auto');
            }
            if (selectedLayout !== 'list' && selectedLayout !== 'solo') {
              jQuery('.product-grid').children().matchHeight({
                target: jQuery('.product-grid').children().first()
              });
            }
          }
          products.isotope('layout');
          products.animate({
            'opacity': 1
          }, 400);
          return isSwitchingLayout = false;
        }), 500);
        return e.preventDefault();
      });
    };
  })(jQuery);

  dev = false;

  jQuery(function($) {
    var getDarkColor, getDarkest, getFirstDark, getFirstLight, getLightColor, getLightest, getPalette, productGrid, productSingle, sortLightToDark;
    tinycolor.prototype.isHalfDark = function() {
      return this.getBrightness() < 192;
    };
    tinycolor.prototype.isHalfLight = function() {
      return !this.isHalfDark();
    };
    sortLightToDark = function(colors) {
      return colors.sort(function(a, b) {
        return a.getLuminance() > b.getLuminance();
      }).reverse();
    };
    getDarkest = function(palette) {
      var sorted;
      sorted = sortLightToDark(palette);
      return sorted.pop();
    };
    getLightest = function(palette) {
      return sortLightToDark(palette)[0];
    };
    getFirstDark = function(colors) {
      var darkColor;
      darkColor = null;
      $.each(colors, function(index, color) {
        if (color.isDark()) {
          darkColor = color;
          return false;
        }
      });
      if (darkColor === null) {
        darkColor = getDarkest(colors);
      }
      return darkColor;
    };
    getFirstLight = function(colors) {
      var lightColor;
      lightColor = null;
      $.each(colors, function(index, color) {
        if (color.isLight()) {
          lightColor = color;
          return false;
        }
      });
      if (lightColor === null) {
        lightColor = getLightest(colors);
      }
      return lightColor;
    };
    getPalette = function(img, num) {
      var colorThief, colors;
      colorThief = new ColorThief();
      colors = colorThief.getPalette(img, num);
      if (colors !== null) {
        return colors.map(function(rgb) {
          return tinycolor({
            r: rgb[0],
            g: rgb[1],
            b: rgb[2]
          });
        });
      }
      return false;
    };
    getDarkColor = function(palette) {
      var color;
      color = palette[0];
      if (color.isLight()) {
        color = getFirstDark(palette);
      }
      return color;
    };
    getLightColor = function(palette) {
      var color;
      color = palette[0];
      if (color.isDark()) {
        color = getFirstLight(palette);
      }
      return color;
    };
    productGrid = function() {
      $('#home-tilawah .products .product').addClass('dark');
      return $('.woocommerce .products .product').each(function() {
        var $this, img, is_dark, new_img;
        $this = $(this);
        is_dark = $this.hasClass('dark');
        img = $this.find('.first-image img')[0];
        if (img == null) {
          return;
        }
        new_img = new Image;
        new_img.onload = function() {
          var artist, color, colorfulBar, details, link_title, palette;
          details = $this.find('.product-details');
          link_title = $this.find('.product-details h3 a');
          artist = $this.find('.product-details h3 a small strong');
          if ((palette = getPalette(new_img, 4))) {
            colorfulBar = '<div class="colorful-bar clearfix">';
            palette.forEach(function(color) {
              return colorfulBar += '<div class="col-xs-3" style="background: ' + tinycolor(color).toRgbString() + '"></div>';
            });
            colorfulBar += '</div>';
            details.before(colorfulBar);
            if (!is_dark) {
              color = getDarkColor(palette);
            } else {
              color = getLightColor(palette);
            }
            details.css({
              'color': color.toRgbString()
            });
            artist.css({
              'border-color': color.setAlpha(.5).toRgbString()
            });
            CDNS.log("product grid " + img.src + " colors fetched.");
            return new_img = null;
          }
        };
        new_img.crossOrigin = "Anonymous";
        return new_img.src = img.src;
      });
    };
    productSingle = function() {
      return $('.woocommerce.single-product').each(function() {
        var $this, img, new_img;
        $this = $(this).addClass('product-fw-split');
        img = $this.find('#product-img-slider img')[0];
        if (img == null) {
          return;
        }
        new_img = new Image;
        new_img.onload = function() {
          var breadcrumb, color, colorfulBar, palette, product_by, product_main, product_title, summary;
          product_main = $('.product-fw-split .product-main');
          summary = $this.find('.summary');
          product_title = $this.find('h1.product_title');
          product_by = product_title.find('small strong');
          breadcrumb = $this.find('.woocommerce-breadcrumb');
          if ((palette = getPalette(new_img, 4))) {
            colorfulBar = '<div class="colorful-bar clearfix">';
            palette.forEach(function(color) {
              return colorfulBar += '<div class="col-xs-3" style="background: ' + tinycolor(color).toRgbString() + '"></div>';
            });
            colorfulBar += '</div>';
            summary.prepend(colorfulBar);
            color = getDarkColor(palette);
            product_main.css({
              'cssText': 'background-color: ' + palette[0].toRgbString() + ' !important; '
            });
            summary.css({
              'color': color.toRgbString()
            });
            product_title.css({
              'color': color.toRgbString()
            });
            summary.find('.nav-previous, .nav-next').css({
              'border-color': color.lighten(40).toRgbString()
            });
            summary.addClass('colored');
            CDNS.log("product single " + img.src + " colors fetched.");
            return new_img = null;
          }
        };
        new_img.crossOrigin = "Anonymous";
        return new_img.src = img.src;
      });
    };
    productGrid();
    return productSingle();
  });

}).call(this);
